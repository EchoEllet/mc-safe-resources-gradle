# Minecraft Safe Resources Gradle Plugin

A simple Gradle plugin to generate Java or Kotlin objects that can be used in the source code
to reference mod assets like `en_us.json` or `sounds.json` in a type-safe way with no hardcoding,
and fully automated.

## Getting Started

> [!TIP]
> This is a minimal guide for setting this Gradle plugin in your mod's Gradle scripts.
> For details on why it's useful, refer to the [Motivation](#motivation) section.

The syntax is slightly different depending on the Gradle DSL language.
Most mods use Groovy (`build.gradle`).

### Kotlin DSL

<details><summary>settings.gradle.kts</summary>

```kotlin
pluginManagement {
    repositories {
        gradlePluginPortal()
        // Temporary: required because this plugin is not yet published on the Gradle Plugin Portal
        //  https://github.com/EchoEllet/minecraft-safe-resources-gradle/issues/1
        maven { url = uri("https://echoellet.github.io/maven-repo/") }
    }
}
```

</details>

<details><summary>build.gradle.kts</summary>

```kotlin
import dev.echoellet.minecraft_safe_resources.GenerateJsonKeysTask
import dev.echoellet.minecraft_safe_resources.OutputLanguage

plugins {
    // ...
    id("dev.echoellet.minecraft-safe-resources") version ("0.0.1")
}

val modAssetsDirPath = "src/main/resources/assets/$modId"

val generateLangKeys = tasks.register<GenerateJsonKeysTask>("generateLangKeys") {
    val enUsResourcePath = "$modAssetsDirPath/lang/en_us.json"

    inputResourceFile.set(project.file(enUsResourcePath))
    outputClassName.set("LangKeys")
    outputLanguage.set(OutputLanguage.JAVA)
    outputClassDescription.set(buildString {
        append("A generated object that represents the keys in `$enUsResourcePath` resource file,"); appendLine()
        append("to avoid hardcoding the keys across the codebase, which is error-prone, inefficient, and less type-safe.")
    })
    outputPackage.set("$modGroupId.generated")
    keyNamespaceToStrip.set(modId)
}

java.sourceSets.main.get().java.srcDir(generateLangKeys.map { it.outputs.files.singleFile })
tasks.compileJava.get().dependsOn(generateLangKeys)
```

</details>

### Groovy DSL

<details><summary>settings.gradle</summary>

```kotlin
pluginManagement {
    repositories {
        gradlePluginPortal()
        // Temporary: required because this plugin is not yet published on the Gradle Plugin Portal
        //  https://github.com/EchoEllet/minecraft-safe-resources-gradle/issues/1
        maven { url = uri("https://echoellet.github.io/maven-repo/") }
    }
}
```

</details>

<details><summary>build.gradle</summary>

```groovy
import dev.echoellet.minecraft_safe_resources.GenerateJsonKeysTask
import dev.echoellet.minecraft_safe_resources.OutputLanguage

plugins {
    // ...
    id("dev.echoellet.minecraft-safe-resources") version("0.0.1")
}

def modAssetsDirPath = "src/main/resources/assets/$mod_id"

def generateLangKeys = tasks.register('generateLangKeys', GenerateJsonKeysTask) {
    def enUsResourcePath = "$modAssetsDirPath/lang/en_us.json"

    inputResourceFile.set(project.file(enUsResourcePath))
    outputClassName.set("LangKeys")
    outputLanguage.set(OutputLanguage.JAVA)
    outputClassDescription.set("""
        A generated object that represents the keys in `$enUsResourcePath` resource file,
        to avoid hardcoding the keys across the codebase, which is error-prone, inefficient, and less type-safe.
    """.stripIndent().trim())
    outputPackage.set("${mod_group_id}.generated")
    keyNamespaceToStrip.set(mod_id)
}

java.sourceSets.main.java.srcDir(generateLangKeys.map { it.outputs.files.singleFile })
tasks.compileJava.dependsOn(generateLangKeys)
```

</details>

> [!NOTE]
> **Kotlin users:** To generate a Kotlin object instead of Java:
>
> ```kotlin
> outputLanguage.set(OutputLanguage.KOTLIN)
> ```

## Motivation

### Problem with Manual Key Reference

Typically, mods have Minecraft asset files, such as `resources/assets/example_mod/lang/en_us.json`:

```json
{
  "item.example_mod.example": "Example Item"
}
```

They need to reference the JSON keys in the source code:

```java
Component.translatable("item.example_mod.example");
```

Yet, this can be inefficient, and you will have to manually test it in-game, as it can be incorrect, outdated, or there
could be a typo, which leads to misleading behavior, bugs, or crashes at runtime.

When you update a key, you will have to manually search for all references in the source code, which is error-prone
and time-consuming, with no IDE auto-completion or tooling support.

### Automated Solution

To address this, an object is automatically generated by this Gradle plugin, which gets updated whenever you run the
game or compile Java code.

```java
Component.translatable(LangKeys.ITEM_EXAMPLE);
```

- The mod ID (e.g., `example_mod`) is automatically removed from the constant field name for readability (
  `item.example_mod.example` -> `ITEM_EXAMPLE`).
- This generated file is not checked into version control by design, and won't affect the source code file tree.

> [!TIP]
> When updating any resource file, run the game (`./gradlew runClient`) or any Gradle task that compiles the code,
> which causes this plugin to update the generated objects, so you can reference the updated objects.
